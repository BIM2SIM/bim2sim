(simulation_setting)=
# Simulation settings
## What are simulation settings?
`bim2sim` uses prescribed settings which define how a specific simulation
should be handled. For basic setup we have a [BaseSimSettings](BaseSimSettings),
which is extended for the different simulation types (e.g.
[BuildingSimSettings](BuildingSimSettings)) and this domain simulation type 
specific settings can also be further specified for each [Plugin](Plugin)
(e.g. [TEASERSimSettings](TEASERSimSettings) or
[EnergyPlusSimSettings](EnergyPlusSimSettings)) via class inheritance.
 
Each [Plugin](Plugin) has a set of predefined settings. But the different settings can 
easily be changed (see below)

## How do settings work?
(sim_settings_concept)=
Each instance of a simulation settings owns a 
[SettingsManager](SettingsManager) to manage all simulation specific 
[Settings](Setting). A setting can be used to concretize the way 
 how [tasks](task) are executed. E.g. the level of detail ([LOD](LOD)) of the 
setting `layers_and_materials` with which the layers of building elements and 
their materials should be inspected can be defined either set LOD.low or 
LOD.full. Currently, each [Setting](Setting) has a specified 
number of choices from which one or multiple can be chosen.

Additionally, to the settings itself, a simulation setting instance holds the 
`relevant_elements`. These define, which of the existing `bim2sim` 
[elements](elements) will be taken into account for the simulation model 
creation. 

## How to set simulation settings?
There are two different ways to set a workflow setting:
* Define the settings inside the `config.toml` file that is part of every 
[FolderStructure](FolderStructure) of every [Project](project.md).
* Define the settings after the project creation by overwriting the existing ones
```python 
project = Project.create(project_path, ifc_path, 'teaser', open_conf=True)
project.sim_settings.layers_and_materials = LOD.low
 ```
If you want to overwrite the specified `relevant_elements` you can 
do this in the same way
```python
project.sim_settings.relevant_elements = {<classes of elements of interest>}
```
The first way is useful if you want to work in an interactive way, the second is 
more fitting for automated tasks.

## Want to set up your own workflow?
The pre-implemented workflows hold the needed settings for the simulation with 
the pre-implemented Plugins. For further customization you can add your own 
Workflow (from scratch or by inheriting from the existing ones) and add your own
settings that you might miss from the existing ones.

## List of current simulation settings:
The following tables provide an overview of simulation settings for the 
different simulation types.

### BaseSimSettings

| Setting Name                | Type    | Default   | Description                                                                                                                                                                                                                                                       |
|:----------------------------|:--------|:----------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| add_space_boundaries        | Boolean | False     | Add space boundaries. Only required for building performance simulation and co-simulations.                                                                                                                                                                       |
| building_rotation_overwrite | Number  | 0         | Overwrite the (clockwise) building rotation angle in degrees.                                                                                                                                                                                                     |
| close_space_boundary_gaps   | Boolean | False     | Close gaps in the set of space boundaries by adding additional 2b space boundaries.                                                                                                                                                                               |
| correct_space_boundaries    | Boolean | False     | Apply geometric correction to space boundaries.                                                                                                                                                                                                                   |
| create_external_elements    | Boolean | False     | Create external elements?                                                                                                                                                                                                                                         |
| dymola_simulation           | Boolean | False     | Run a Simulation with Dymola after model export?                                                                                                                                                                                                                  |
| fuzzy_threshold             | Number  | 0.7       | If you want to use fuzzy search in the group_unidentified setting, you can set the threshold here. A low threshold means a small similarity is required for grouping. A too low value might result in grouping elements which do not represent the same IFC type. |
| group_unidentified          | Choice  | fuzzy     | To reduce the number of decisions by user to identify elements which can not be identified automatically by the system, you can either use simple grouping by same name of IFC element or fuzzy search to group based on similarities in name.                    |
| max_wall_thickness          | Number  | 0.3       | Choose maximum wall thickness as a tolerance for mapping opening boundaries to their base surface (Wall). Choose 0.3m as a default value.                                                                                                                         |
| reset_guids                 | Boolean | False     | Reset GlobalIDs from imported IFC if duplicate GlobalIDs occur in the IFC. As EnergyPlus evaluates allGlobalIDs upper case only, this might also be applicable if duplicate non-case-sensitive GlobalIDs occur.                                                   |

### PlantSimSettings

| Setting Name    | Type    | Default | Description                                                                            |
|-----------------|---------|---------|----------------------------------------------------------------------------------------|
| aggregations    | Choice (MultipleChoice) | [list]  | Choose which aggregations should be applied on the hydraulic network.                  |

### BuildingSimSettings

| Setting Name                    | Type       | Default         | Description                                                                                  |
|---------------------------------|------------|-----------------|----------------------------------------------------------------------------------------------|
| layers_and_materials            | Choice     | LOD.low         | Select how existing Material information in IFC should be treated.                           |
| construction_class_walls        | Choice     | 'heavy'         | Select the most fitting type of construction class for the walls of the selected building.   |
| year_of_construction_overwrite  | Number     | None            | Force an overwrite of the year of construction as a base for the selected construction set.  |
| construction_class_windows      | Choice     | 'Alu- oder...'  | Select the most fitting type of construction class for the windows of the selected building. |
| heating                         | Boolean    | True            | Whether the building should be supplied with heating.                                        |
| cooling                         | Boolean    | False           | Whether the building should be supplied with cooling.                                        |
| deactivate_ahu                  | Boolean    | False           | If True, the AHU unit will be deactivated for all thermal zones.                             |
| prj_use_conditions              | Path       | None            | Path to a custom UseConditions.json for the specific project.                                |
| prj_custom_usages               | Path       | None            | Path to a custom customUsages.json for the specific project.                                 |
| setpoints_from_template         | Boolean    | False           | Use template heating and cooling profiles instead of setpoints from IFC.                     |

### TEASERSimSettings

| Setting Name    | Type    | Default | Description                                                                             |
|-----------------|---------|---------|-----------------------------------------------------------------------------------------|
| zoning_setup    | Choice  | LOD.low | Select the criteria based on which thermal zones will be aggregated.                      |
| zoning_criteria | Choice  | ZoningCriteria.usage | Choose the zoning criteria for thermal zone aggregation.                                 |

### EnergyPlusSimSettings
(EnergyPlus_sim_settings)=

| Setting Name            | Type                    | Default                                                                                                         | Description                                                                                                   | Choices                                                                                                                                               |
|-------------------------|-------------------------|-----------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| cfd_export              | Boolean                 | False                                                                                                           | Whether to use CFD export for this simulation or not.                                                         |                                                                                                                                                       |
| split_bounds            | Boolean                 | False                                                                                                           | Whether to convert non-convex space boundaries or not.                                                        |                                                                                                                                                       |
| add_shadings            | Boolean                 | True                                                                                                            | Whether to add shading surfaces if available or not.                                                          |                                                                                                                                                       |
| split_shadings          | Boolean                 | False                                                                                                           | Whether to convert non-convex shading boundaries or not.                                                      |                                                                                                                                                       |
| run_full_simulation     | Boolean                 | False                                                                                                           | Choose simulation period.                                                                                     |                                                                                                                                                       |
| ep_version              | Choice                  | '9-4-0'                                                                                                         | Choose EnergyPlus Version.                                                                                    | '9-2-0', '9-4-0'                                                                                                                                      |
| ep_install_path         | Path                    | Path('/usr/local/EnergyPlus-9-4-0/')                                                                            | Choose EnergyPlus Installation Path.                                                                          |                                                                                                                                                       |
| system_sizing           | Boolean                 | True                                                                                                            | Whether to do system sizing calculations in EnergyPlus or not.                                                |                                                                                                                                                       |
| run_for_sizing_periods  | Boolean                 | False                                                                                                           | Whether to run the EnergyPlus simulation for sizing periods or not.                                           |                                                                                                                                                       |
| run_for_weather_period  | Boolean                 | True                                                                                                            | Whether to run the EnergyPlus simulation for weather file period or not.                                      |                                                                                                                                                       |
| system_weather_sizing   | Choice                  | 'Typical'                                                                                                       | Choose whether to perform the system sizing for DesignDays, extreme weather periods, typical weather periods. | 'Typical', Extreme', 'DesignDay'                                                                                                                      |
| solar_distribution      | Choice                  | 'FullExterior'                                                                                                  | Choose solar distribution.                                                                                    | 'FullExterior', 'FullInteriorAndExterior'                                                                                                             |
| add_window_shading      | Choice                  | None                                                                                                            | Choose window shading.                                                                                        | 'Interior', 'Exterior'                                                                                                                                |
| output_format           | Choice                  | 'CommaAndHTML'                                                                                                  | Choose output format for result files.                                                                        | 'Comma', 'Tab', 'Fixed', 'HTML', 'XML', 'CommaAndHTML','TabAndHTML', 'XMLAndHTML', 'All'                                                              |
| unit_conversion         | Choice                  | 'JtoKWH'                                                                                                        | Choose unit conversion for result files.                                                                      | 'None', 'JtoKWH', JtoMJ', 'JtoGJ', 'InchPound'                                                                                                        |
| output_keys             | Choice (MultipleChoice) | ['output_outdoor_conditions', 'output_zone_temperature', 'output_zone', 'output_infiltration', 'output_meters'] | Choose groups of output variables (multiple choice).                                                          | 'output_outdoor_conditions', 'output_internal_gains', 'output_zone_temperature', 'output_zone', 'output_infiltration', 'output_meters',  'output_dxf' |
| add_natural_ventilation | Boolean                 | True                                                                                                            | Activates natural ventilation if cooling is not activated.                                                    |

### OpenFOAMSimSettings
(OpenFOAM_sim_settings)=

| Setting Name                   | Type    | Default      | Description                                                                                                                                                                                                                   | Choices                                                                                                                                                                                                                                                                                                                                                          |
|:-------------------------------|:--------|:-------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| add_heating                    | Boolean | True         | Whether to add heating devices or not.                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                  |
| add_floorheating               | Boolean | False        | Whether to add floorheating instead of usual radiators.                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                  |
| add_airterminals               | Boolean | True         | Whether to add air terminals or not.                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                  |
| ignore_heatloss                | Boolean | False        | Ignores heat loss through walls if set to True.                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                  |
| inlet_type                     | Choice  | 'Plate'      | Choose air terminal inlet type.                                                                                                                                                                                               | 'Original': Simplified IFC shape for inlet<br>'Plate': Simplified plate for inlet<br>'StlDiffusor': Inlet diffusor from stl file<br>'SimpleStlDiffusor': Simplified inlet diffusor from stl file<br>'IfcDiffusor': Inlet diffusor modified from ifc file (if available), otherwise stl diffusor from file.<br>'None': No inlet plate, only gap in ceiling.       |
| outlet_type                    | Choice  | 'Plate'      | Choose air terminal outlet type.                                                                                                                                                                                              | 'Original': Simplified IFC shape for outlet<br>'Plate': Simplified plate for outlet<br>'StlDiffusor': Outlet diffusor from stl file<br>'SimpleStlDiffusor': Simplified outlet diffusor from stl file<br>'IfcDiffusor': Outlet diffusor modified from ifc file (if available), otherwise stl diffusor from file.<br>'None': No outlet plate, only gap in ceiling. |
| outflow_direction              | Choice  | 'down'       | Choose the outflow direction for original shapes from IFC<br>that should be automatically processed. Defaults to downward<br>facing flows.                                                                                    | 'down': Outflow facing downward. Only applicable for original shapes.<br>'side': Outflow facing sideways. Only applicable for original shapes.<br>'angle45down': Outflow facing downward with a 45 degrees angle. Only applicable for original shapes.                                                                                                           |
| select_space_guid              | Choice  | ''           | Select space for OpenFOAM simulation by setting the space<br>guid.                                                                                                                                                            | '': No guid selected, first space will be selected.                                                                                                                                                                                                                                                                                                              |
| simulation_date                | Choice  | '12/21'      | Select date of simulation according to simulated timeframe<br>in the PluginEnergyPlus. Insert as string in format MM/DD.                                                                                                      | '12/21': Winter design day<br>'07/21': Summer design day                                                                                                                                                                                                                                                                                                         |
| simulation_time                | Number  | 11           | Select time of simulation according to simulated timeframe<br>in the PluginEnergyPlus. Insert as number (time) for the<br>full hour ranging 1 to 24.                                                                          |                                                                                                                                                                                                                                                                                                                                                                  |
| simulation_type                | Choice  | 'steady'     | Select simulation type (steady-state, combined or<br>transient).                                                                                                                                                              | 'steady': steady-state simulation<br>'combined': preconditioned transient simulation<br>'transient': transient simulation                                                                                                                                                                                                                                        |
| mesh_size                      | Number  | 0.1          | Set the mesh size of the blockMesh in [m]. Insert a number<br>between 0.001 and 0.2.                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                  |
| mesh_max_global_cells          | Number  | 3000000      | Set the maximum number of global cells for meshing in<br>snappyHexMesh.                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                  |
| adjust_refinements             | Boolean | False        | Whether surface and region refinements of airterminals and<br>interior elements should be automatically recomputed or not.                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                  |
| total_iterations               | Number  | 20000        | Total number of iterations for the simulation.                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                  |
| steady_iterations              | Number  | 2500         | Select number of steady iterations for preconditioning a<br>transient simulation.                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                  |
| n_procs                        | Number  | 12           | Set the number of processors for decomposition and<br>simulation.                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                  |
| run_meshing                    | Boolean | False        | Whether to run OpenFOAM meshing or not. Only available for<br>linux systems.                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                  |
| run_cfd_simulation             | Boolean | False        | Whether to run the OpenFOAM CFD simulation or not. Only<br>available for linux systems.                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                  |
| heater_radiation               | Number  | 0.3          | Select the radiative portion of the heating heat transfer.<br>Choose between 0 and 1.                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                  |
| add_comfort                    | Boolean | True         | Whether to add thermal comfort settings to OpenFOAM                                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                                                  |
| add_furniture                  | Boolean | False        | Whether to add furniture to OpenFOAM                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                  |
| level_heat_balance             | Boolean | True         | Whether to level heat balance: reduce heating towards<br>leveled heat balance considering internal gains.                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                  |
| furniture_setting              | Choice  | 'Office'     | Select the type of furniture to add.                                                                                                                                                                                          | 'Office': Office setup, chair and desk<br>'Concert': Concert setup, chairs in rows<br>'Meeting': Meeting setup, large table with chairs<br>'TwoSideTable': Table with chairs on long side<br>'GroupTable': Group table with chairs<br>'Classroom': Classroom setup, individual tables with chairs                                                                |
| furniture_amount               | Number  | 1            |                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                  |
| furniture_orientation          | Choice  | 'short_side' |                                                                                                                                                                                                                               | 'long_side': Long side of a rectangular space<br>'short_side': short side of a rectangular space<br>'window': window side of a rectangular space<br>'door': door side of a rectangular space<br>'north': North side<br>'east': East side<br>'south': South side<br>'west': West side                                                                             |
| add_people                     | Boolean | False        | Choose if people should be added.                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                  |
| use_energyplus_people_amount   | Boolean | False        | Choose if number of people should be assigned as defined in<br>the EnergyPlus simulation. If true, people_amount is not<br>considered but overwritten with the rounded up number of<br>people from the EnergyPlus simulation. |                                                                                                                                                                                                                                                                                                                                                                  |
| people_setting                 | Choice  | 'Seated'     | Select type of people positioning to add.                                                                                                                                                                                     | 'Seated': Seated, furniture needs to be provided in sufficient amount. <br>'Standing': Standing, no furniture required.                                                                                                                                                                                                                                          |
| people_amount                  | Number  | 1            |                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                  |
| radiation_model                | Choice  | 'P1'         | Choose the radiation model                                                                                                                                                                                                    | 'none': No radiation<br>'P1': Use P1 Radiation Model<br>'fvDOM': Use fvDOM Radiation Model<br>'preconditioned_fvDOM': Use P1 to precondition fvDOM Radiation                                                                                                                                                                                                     |
| radiation_precondition_time    | Number  | 1000         | Choose number of preconditioning iterations using P1<br>radiation for fvDOM radiation                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                  |
| add_solar_radiation            | Boolean | True         | Add solar radiation. Requires fvDOM as radiation model.                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                  |
| add_air_volume_evaluation      | Boolean | False        | Add an air volume evaluation. Removes voids of all people,<br>furniture elements, and heaters, to enhance the evaluation<br>of the air volume itself. This is computationally expensive.                                      |                                                                                                                                                                                                                                                                                                                                                                  |
| scale_person_for_eval          | Number  | 0.05         | Scale shape of person for evaluation in paraview.                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                  |
| mesh_feature_snapping          | Boolean | False        | Choose if explicit surface feature snapping should be<br>applied in snappyHexMesh.                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                  |
| cluster_jobname                | Choice  | 'newJob'     | Jobname that is used when running the simulation via a batch<br>script on the RWTH Compute Cluster.                                                                                                                           | 'fullRun': Specify content<br>'Job1234': Enumerate                                                                                                                                                                                                                                                                                                               |
| cluster_compute_account        | Choice  | ''           | Specify the compute account that is used for running the<br>simulation on the RWTH Compute Cluster. Specify as<br>"thes1234".                                                                                                 | '': Skip defining compute cluster account.<br>'thes1234': Define thesis account<br>'rwth5678': Define user account                                                                                                                                                                                                                                               |
| cluster_max_runtime_simulation | Choice  | '23:59:00'   | Max runtime for a full simulation in the format of<br>"D:HH:MM:SS".                                                                                                                                                           | '11:59:00': 12 hours<br>'06:00:00': 6 hours                                                                                                                                                                                                                                                                                                                      |
| cluster_max_runtime_meshing    | Choice  | '00:59:00'   | Max runtime for meshing in the format of D:HH:MM:SS .                                                                                                                                                                         | '00:30:00': 30 minutes<br>'00:15:00': 15 minutes                                                                                                                                                                                                                                                                                                                 |
| cluster_cpu_per_node           | Number  | 96           | Number of physical cores per node.                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                  |


### CFDSimSettings

No specific settings provided.

### LCAExportSettings

No specific settings provided.

### ComfortSimSettings
(ComfortSimSettings)=

| Setting Name           | Type      | Default           | Description                                                      |
|------------------------|-----------|-------------------|------------------------------------------------------------------|
| prj_use_conditions     | [Path]    | 'UseConditionsComfort.json' in PluginComfort | Path to a custom UseConditions.json for the comfort application. |
| use_dynamic_clothing   | Boolean   | False             | Use dynamic clothing according to ASHRAE 55 standard.            |
| rename_plot_keys       | Boolean   | False             | Rename the space names for optimized plotting results. By default, rename_plot_keys.json file is used for renaming, unless rename_plot_keys_path is specified. |
| rename_plot_keys_path  | [Path]    | 'rename_plot_keys.json' in PluginComfort | Path for renaming the zone keys for plot results. Path to a json file with pairs of current keys and new keys. |