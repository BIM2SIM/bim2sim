{% set data = load_setup_py_data(setup_file='../../../bim2sim/plugins/PluginLCA/setup.py', from_recipe_dir=True) %}
{% set requirements  = load_file_data('../../../bim2sim/plugins/PluginLCA/environment.yml', from_recipe_dir=True) %}

package:
  name:  {{BIM2SIM_NAME}}
  version: {{data.get('version')}}{{BIM2SIM_FLAG}}

source:
  path: ../../../

build:
  preserve_egg_dir: True
  number: '0'
  entry_points:
    - bim2sim = bim2sim.__main__:commandline_interface

requirements:
  host:
    - python>=3.8,<3.10
    - pip
    - setuptools
  run:
    - bim2sim_base=={{BIM2SIM_BASE_VERSION}}{{BIM2SIM_FLAG}}
    {% for dep in requirements[ "dependencies" ] %}
      {%- if dep != { 'pip': [ '-r bim2sim/plugins/PluginLCA/requirements.txt', '-r bim2sim/plugins/PluginLCA/dependency_requirements.txt', '-r requirements.txt', '-r dependency_requirements.txt' ] } and dep != "bim2sim_base" -%}
      - {{ dep.lower() }}
      {%- endif %}
    {% endfor %}

test:
  imports:
    - bim2sim
  requires:
    - python  >=3.8,<3.10
    - bim2sim_base=={{BIM2SIM_BASE_VERSION}}{{BIM2SIM_FLAG}}
  commands:
    - conda list
    - bim2sim -h
    - bim2sim --version
    - bash conda_recipe/plugins/PluginLCA/test_lca.sh # [not win]
    - conda_recipe/plugins/PluginLCA/test_lca.bat # [ win]
  source_files:
    - conda_recipe/plugins/PluginLCA/test_lca.sh # [not win]
    - conda_recipe/plugins/PluginLCA/test_lca.bat # [ win]
    - bim2sim
    - test
    - requirements.txt
    - dependency_requirements.txt
    # bim2sim/plugins/PluginLCA/requirements.txt
    # bim2sim/plugins/PluginLCA/dependency_requirements.txt

about:
  home: https://github.com/BIM2SIM/bim2sim
  summary: "Create simulation models from IFC files"
  description: "Create simulation models from IFC files"
  license: LICENSE

extra:
  copy_test_source_files: true
  final: true
